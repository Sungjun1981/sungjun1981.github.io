// Translation data
const translations = {
  ko: {
    'nav.name': '박성준',
    'nav.about': '소개',
    'nav.experience': '경력',
    'nav.education': '학력',
    'nav.certifications': '자격증',
    'nav.contact': '연락',
    'hero.name': '박성준',
    'hero.title': '(주)씨원 과장',
    'hero.expertise': '안전 관리 및 가스 공급 시스템',
    'hero.contact': '연락하기',
    'hero.learn_more': '더 알아보기',
    'about.title': '소개',
    'about.description': '안전 관리, 가스 공급 시스템 및 실험실 운영 분야에서 20년 이상의 경험을 가진 전문가입니다. 현재 건설 현장 안전 관리에 집중하면서 사무 자동화 및 안전 교육 애플리케이션을 위한 소프트웨어 개발에 관심을 두고 있습니다.',
    'about.years_experience': '년 경험',
    'about.certifications': '자격증',
    'about.degrees': '학위',
    'experience.title': '경력',
    'experience.current': '현재',
    'experience.c1_position': '과장',
    'experience.c1_description': '건설 현장 및 위험 작업 안전 관리',
    'experience.samsung_position': '안전관리 대리',
    'experience.samsung_description': '반도체 FAB용 가스 공급 장치 관리, 기업 부속 실험실 안전 관리',
    'education.title': '학력',
    'education.bachelor': '학사',
    'education.associate': '관광일어통역 전문학사',
    'certifications.title': '자격증',
    'cert.construction': '건설기술경력증 초급',
    'cert.python': 'Python 프로그래밍 기초',
    'cert.safety': '건설안전산업기사',
    'cert.communication': '통신선로기능사',
    'cert.machinery': '기계설계산업기사',
    'cert.computational': '컴퓨팅사고능력3급',
    'cert.cad_mechanical': '전산응용기계제도기능사',
    'cert.cad_milling': '컴퓨터응용밀링기능사',
    'cert.machine_fitting': '기계가공조립기능사',
    'contact.title': '연락',
    'contact.get_in_touch': '연락하기',
    'contact.message': '프로젝트 협업이나 문의사항이 있으시면 언제든 연락해 주세요.',
    'contact.form.name': '이름',
    'contact.form.email': '이메일',
    'contact.form.subject': '제목',
    'contact.form.message': '메시지',
    'contact.form.send': '전송',
    'footer.name': '박성준',
    'footer.rights': '모든 권리 보유.'
  },
  en: {
    'nav.name': 'Sungjun Park',
    'nav.about': 'About',
    'nav.experience': 'Experience',
    'nav.education': 'Education',
    'nav.certifications': 'Certifications',
    'nav.contact': 'Contact',
    'hero.name': 'Sungjun Park',
    'hero.title': 'Manager at C1 Corporation',
    'hero.expertise': 'Safety Management & Gas Supply Systems',
    'hero.contact': 'Contact Me',
    'hero.learn_more': 'Learn More',
    'about.title': 'About Me',
    'about.description': 'Experienced professional with over 20 years in safety management, gas supply systems, and laboratory operations. Currently focusing on construction site safety management while pursuing interests in software development for automation and safety training applications.',
    'about.years_experience': 'Years Experience',
    'about.certifications': 'Certifications',
    'about.degrees': 'Degrees',
    'experience.title': 'Experience',
    'experience.current': 'Current',
    'experience.c1_position': 'Manager',
    'experience.c1_description': 'Construction site and hazardous work safety management',
    'experience.samsung_position': 'Safety Manager',
    'experience.samsung_description': 'Gas supply system management for semiconductor FAB, Laboratory safety management',
    'education.title': 'Education',
    'education.bachelor': "Bachelor's Degree",
    'education.associate': 'Associate Degree in Tourism Japanese Interpretation',
    'certifications.title': 'Certifications',
    'cert.construction': 'Construction Technology Career Certification - Entry Level',
    'cert.python': 'Python Programming Basics',
    'cert.safety': 'Industrial Engineer Construction Safety',
    'cert.communication': 'Craftsman Communication Cable',
    'cert.machinery': 'Industrial Engineer Machinery Design',
    'cert.computational': 'Computational Thinking Level 3',
    'cert.cad_mechanical': 'Craftsman Computer Aided Mechanical Drawing',
    'cert.cad_milling': 'Craftsman Computer Aided Milling',
    'cert.machine_fitting': 'Craftsman Machine Fitting',
    'contact.title': 'Contact',
    'contact.get_in_touch': 'Get In Touch',
    'contact.message': 'Feel free to reach out for project collaboration or any inquiries.',
    'contact.form.name': 'Name',
    'contact.form.email': 'Email',
    'contact.form.subject': 'Subject',
    'contact.form.message': 'Message',
    'contact.form.send': 'Send Message',
    'footer.name': 'Sungjun Park',
    'footer.rights': 'All rights reserved.'
  },
  ja: {
    'nav.name': 'パク・ソンジュン',
    'nav.about': '紹介',
    'nav.experience': '経歴',
    'nav.education': '学歴',
    'nav.certifications': '資格',
    'nav.contact': '連絡',
    'hero.name': 'パク・ソンジュン',
    'hero.title': '株式会社C1 課長',
    'hero.expertise': '安全管理・ガス供給システム',
    'hero.contact': 'お問い合わせ',
    'hero.learn_more': '詳しく見る',
    'about.title': '紹介',
    'about.description': '安全管理、ガス供給システム、実験室運営の分野で20年以上の経験を持つ専門家です。現在は建設現場の安全管理に注力しながら、業務自動化と安全教育アプリケーション向けのソフトウェア開発に興味を持っています。',
    'about.years_experience': '年の経験',
    'about.certifications': '資格',
    'about.degrees': '学位',
    'experience.title': '経歴',
    'experience.current': '現在',
    'experience.c1_position': '課長',
    'experience.c1_description': '建設現場および危険作業の安全管理',
    'experience.samsung_position': '安全管理代理',
    'experience.samsung_description': '半導体FAB用ガス供給装置管理、企業付属実験室安全管理',
    'education.title': '学歴',
    'education.bachelor': '学士',
    'education.associate': '観光日本語通訳専門学士',
    'certifications.title': '資格',
    'cert.construction': '建設技術経歴証初級',
    'cert.python': 'Pythonプログラミング基礎',
    'cert.safety': '建設安全産業技師',
    'cert.communication': '通信線路技能士',
    'cert.machinery': '機械設計産業技師',
    'cert.computational': 'コンピューティング思考能力3級',
    'cert.cad_mechanical': 'コンピュータ応用機械製図技能士',
    'cert.cad_milling': 'コンピュータ応用ミーリング技能士',
    'cert.machine_fitting': '機械加工組立技能士',
    'contact.title': '連絡',
    'contact.get_in_touch': 'お問い合わせ',
    'contact.message': 'プロジェクトの協力やご質問がございましたら、お気軽にご連絡ください。',
    'contact.form.name': '名前',
    'contact.form.email': 'メール',
    'contact.form.subject': '件名',
    'contact.form.message': 'メッセージ',
    'contact.form.send': '送信',
    'footer.name': 'パク・ソンジュン',
    'footer.rights': 'All rights reserved.'
  }
};

// Current language state
let currentLanguage = 'ko';

// Initialize application
document.addEventListener('DOMContentLoaded', function() {
  console.log('DOM loaded, initializing app...');
  initializeApp();
});

function initializeApp() {
  // Set up all event listeners and functionality
  setupLanguageSwitcher();
  setupContactForm();
  setupSmoothScrolling();
  setupScrollAnimations();
  
  // Set initial language to Korean as specified
  changeLanguage('ko');
  console.log('App initialized successfully');
}

// Language switcher functionality
function setupLanguageSwitcher() {
  const langButtons = document.querySelectorAll('.lang-btn');
  console.log('Found language buttons:', langButtons.length);
  
  langButtons.forEach(button => {
    button.addEventListener('click', function(e) {
      e.preventDefault();
      const lang = this.getAttribute('data-lang');
      console.log('Language button clicked:', lang);
      changeLanguage(lang);
    });
  });
}

function changeLanguage(lang) {
  console.log('Changing language to:', lang);
  
  if (!translations[lang]) {
    console.error('Translation not found for language:', lang);
    return;
  }
  
  currentLanguage = lang;
  
  // Update active button
  const langButtons = document.querySelectorAll('.lang-btn');
  langButtons.forEach(button => {
    button.classList.remove('active');
    if (button.getAttribute('data-lang') === lang) {
      button.classList.add('active');
    }
  });
  
  // Update all translatable elements
  const elements = document.querySelectorAll('[data-i18n]');
  console.log('Updating translatable elements:', elements.length);
  
  elements.forEach(element => {
    const key = element.getAttribute('data-i18n');
    if (translations[lang][key]) {
      element.textContent = translations[lang][key];
    } else {
      console.warn('Translation key not found:', key, 'for language:', lang);
    }
  });
  
  // Update document language
  document.documentElement.lang = lang;
  
  // Update page title
  const titleMap = {
    ko: '박성준 - 포트폴리오',
    en: 'Sungjun Park - Portfolio',
    ja: 'パク・ソンジュン - ポートフォリオ'
  };
  document.title = titleMap[lang] || titleMap.ko;
  
  console.log('Language changed successfully to:', lang);
}

// Contact form functionality
function setupContactForm() {
  const contactForm = document.getElementById('contactForm');
  
  if (!contactForm) {
    console.error('Contact form not found');
    return;
  }
  
  console.log('Setting up contact form...');
  
  contactForm.addEventListener('submit', function(e) {
    e.preventDefault();
    console.log('Contact form submitted');
    
    const name = document.getElementById('name').value.trim();
    const email = document.getElementById('email').value.trim();
    const subject = document.getElementById('subject').value.trim();
    const message = document.getElementById('message').value.trim();
    
    console.log('Form data:', { name, email, subject, message });
    
    // Validate form
    if (!name || !email || !subject || !message) {
      alert('모든 필드를 입력해주세요. / Please fill in all fields. / すべてのフィールドを入力してください。');
      return;
    }
    
    // Validate email format
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    if (!emailRegex.test(email)) {
      alert('올바른 이메일 주소를 입력해주세요. / Please enter a valid email address. / 有効なメールアドレスを入力してください。');
      return;
    }
    
    // Create mailto link
    const emailBody = `Name: ${name}\nEmail: ${email}\n\nMessage:\n${message}`;
    const mailtoLink = `mailto:junjun.park@gmail.com?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(emailBody)}`;
    
    console.log('Opening mailto link:', mailtoLink);
    
    // Open email client
    try {
      window.location.href = mailtoLink;
      
      // Show success message
      alert('이메일 클라이언트가 열립니다. / Email client will open. / メールクライアントが開きます。');
      
      // Reset form after successful submission
      setTimeout(() => {
        contactForm.reset();
      }, 1000);
      
    } catch (error) {
      console.error('Error opening mailto link:', error);
      alert('이메일 클라이언트를 열 수 없습니다. / Cannot open email client. / メールクライアントを開けません。');
    }
  });
}

// Smooth scrolling for navigation links
function setupSmoothScrolling() {
  // Get all navigation links that start with #
  const navLinks = document.querySelectorAll('a[href^="#"]');
  console.log('Setting up smooth scrolling for links:', navLinks.length);
  
  navLinks.forEach(link => {
    link.addEventListener('click', function(e) {
      e.preventDefault();
      
      const href = this.getAttribute('href');
      console.log('Navigation link clicked:', href);
      
      if (href === '#') {
        // Scroll to top
        window.scrollTo({
          top: 0,
          behavior: 'smooth'
        });
        return;
      }
      
      const targetId = href.substring(1);
      const targetElement = document.getElementById(targetId);
      
      if (targetElement) {
        console.log('Scrolling to element:', targetId);
        const offsetTop = targetElement.offsetTop - 80; // Account for fixed navbar
        window.scrollTo({
          top: offsetTop,
          behavior: 'smooth'
        });
      } else {
        console.warn('Target element not found:', targetId);
      }
    });
  });
}

// Scroll animations and effects
function setupScrollAnimations() {
  console.log('Setting up scroll animations...');
  
  // Intersection Observer for fade-in animations
  const observerOptions = {
    threshold: 0.1,
    rootMargin: '0px 0px -50px 0px'
  };
  
  const observer = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        entry.target.style.opacity = '1';
        entry.target.style.transform = 'translateY(0)';
      }
    });
  }, observerOptions);
  
  // Observe sections for animations
  const animatedElements = document.querySelectorAll('.timeline-item, .education-card, .certification-card');
  
  animatedElements.forEach(element => {
    element.style.opacity = '0';
    element.style.transform = 'translateY(30px)';
    element.style.transition = 'opacity 0.8s ease-out, transform 0.8s ease-out';
    observer.observe(element);
  });
  
  // Navbar background on scroll
  window.addEventListener('scroll', function() {
    const navbar = document.querySelector('.navbar');
    if (navbar) {
      if (window.scrollY > 50) {
        navbar.style.background = 'rgba(255, 255, 255, 0.98)';
        navbar.style.boxShadow = '0 2px 20px rgba(0, 0, 0, 0.1)';
      } else {
        navbar.style.background = 'rgba(255, 255, 255, 0.95)';
        navbar.style.boxShadow = 'none';
      }
    }
  });
  
  // Staggered animation for certification cards
  const certificationsSection = document.getElementById('certifications');
  if (certificationsSection) {
    const cardsObserver = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          const cards = entry.target.querySelectorAll('.certification-card');
          cards.forEach((card, index) => {
            setTimeout(() => {
              card.style.opacity = '1';
              card.style.transform = 'translateY(0)';
            }, index * 100);
          });
          cardsObserver.unobserve(entry.target);
        }
      });
    }, { threshold: 0.2 });
    
    cardsObserver.observe(certificationsSection);
  }
}

// Helper function to get translation with fallback
function getTranslation(key, fallback = '') {
  return translations[currentLanguage] && translations[currentLanguage][key] 
    ? translations[currentLanguage][key] 
    : fallback;
}

// Keyboard navigation support
document.addEventListener('keydown', function(e) {
  // Ctrl/Cmd + Arrow keys for language switching
  if ((e.ctrlKey || e.metaKey) && (e.key === 'ArrowLeft' || e.key === 'ArrowRight')) {
    e.preventDefault();
    const languages = ['ko', 'en', 'ja'];
    const currentIndex = languages.indexOf(currentLanguage);
    let newIndex;
    
    if (e.key === 'ArrowLeft') {
      newIndex = currentIndex > 0 ? currentIndex - 1 : languages.length - 1;
    } else {
      newIndex = currentIndex < languages.length - 1 ? currentIndex + 1 : 0;
    }
    
    changeLanguage(languages[newIndex]);
  }
});

// Add print-friendly styles
const printStyles = `
  @media print {
    .language-switcher,
    .navbar,
    .hero-actions,
    .contact-form {
      display: none !important;
    }
    
    body {
      background: white !important;
    }
    
    section {
      break-inside: avoid;
      page-break-inside: avoid;
    }
    
    .hero {
      background: white !important;
    }
    
    .card, .timeline-content {
      border: 1px solid #ccc !important;
      box-shadow: none !important;
    }
  }
`;

// Inject print styles
const styleSheet = document.createElement('style');
styleSheet.textContent = printStyles;
document.head.appendChild(styleSheet);

// Debug function to check if all elements are loaded
function debugApp() {
  console.log('=== DEBUG INFO ===');
  console.log('Current language:', currentLanguage);
  console.log('Language buttons:', document.querySelectorAll('.lang-btn').length);
  console.log('Nav links:', document.querySelectorAll('.nav-menu a').length);
  console.log('Contact form:', !!document.getElementById('contactForm'));
  console.log('Translatable elements:', document.querySelectorAll('[data-i18n]').length);
}

// Call debug function after a short delay to ensure everything is loaded
setTimeout(debugApp, 1000);